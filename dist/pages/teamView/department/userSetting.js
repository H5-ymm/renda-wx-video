"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),_wepy=require("./../../../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_http=require("./../../../http.js"),_userSettingList=require("./../../../components/userSettingList.js"),_userSettingList2=_interopRequireDefault(_userSettingList),_util=require("./../../../util.js"),department=function(t){function e(){var t,i,n,s;_classCallCheck(this,e);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];return i=n=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(a))),n.$repeat={},n.$props={userSettingList:{bindsettingRole:"settingRole","xmlns:v-bind":"","v-bind:list.sync":"list"}},n.$events={},n.components={userSettingList:_userSettingList2.default},n.data={list:[],count:0,params:{uid:"",page:1,limit:10,departId:"",gradeId:""},jobList:[],depList:[],depId:"",isPicker:!1,depIndex:[0,0],userId:"",gradeId:""},n.config={navigationBarTitleText:"人员调整"},n.events={settingRole:function(t){n.isPicker=!0,n.depId=t.depart_id,n.userId=t.uid,n.$apply(),n.getDepartmenList()}},n.methods={bindChange:function(t){this.depIndex=t.detail.value,this.jobList=this.getArr(this.depList,this.depList[this.depIndex[0]].id),this.$apply()},selectClose:function(){this.isPicker=!1,this.$apply(),this.$broadcast("editSuccess")},selectOk:function(){this.gradeId=this.jobList[this.depIndex[1]].id;var t={gradeId:this.gradeId,uid:this.params.uid,userId:this.userId};this.editTeamUserRole(t)},addDep:function(){this.isModal=!this.isModal,this.$apply()},searchScrollLower:function(){this.count>this.list.length&&this.count>this.params.limit&&(this.params.limit=this.params.limit+10,this.getAdjustmentList())}},s=i,_possibleConstructorReturn(n,s)}return _inherits(e,t),_createClass(e,[{key:"getAdjustmentList",value:function(){var t=this;(0,_http.$http)("/team/adjustmentList",this.params).then(function(e){t.list=e.data.data||[],t.count=e.data.count,t.$apply()})}},{key:"editTeamUserRole",value:function(t){var e=this;(0,_http.$http)("/team/editTeamUserRole",t).then(function(t){t.data&&((0,_util.wxToast)("人员调整成功"),e.gradeId=""),e.isPicker=!1,e.$broadcast("editSuccess"),e.getAdjustmentList(),e.$apply()})}},{key:"getDepartmenList",value:function(){var t=this;(0,_http.$http)("/team/departmentRoleList",{uid:this.params.uid}).then(function(e){var i=e.data||[];t.depList=i,t.depIndex[0]=t.getIndex(t.depList,t.depId),t.depId||(t.depId=t.depList[0].id),t.jobList=t.getArr(t.depList,t.depId),t.depIndex[1]=t.getIndex(t.jobList,t.gradeId),t.$apply()})}},{key:"getIndex",value:function(t,e){var i=0;return t.forEach(function(t,n){t.id==e&&(i=n)}),i}},{key:"getCurrentDepList",value:function(t){var e=this,i=[];return t.filter(function(t){t.id==e.depId&&i.push(t)}),i}},{key:"getArr",value:function(t,e){var i=[];return t.forEach(function(t){t.id==e&&(i=t.child)}),i}},{key:"onLoad",value:function(t){this.params.departId=t.query,this.params.uid=wx.getStorageSync("rendaUid")||this.$parent.globalData.uid}},{key:"onShow",value:function(){this.getAdjustmentList()}}]),e}(_wepy2.default.page);Page(require("./../../../npm/wepy/lib/wepy.js").default.$createPage(department,"pages/teamView/department/userSetting"));