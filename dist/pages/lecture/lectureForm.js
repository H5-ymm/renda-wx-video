"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),_wepy=require("./../../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_util=require("./../../util.js"),_moment=require("./../../npm/moment/moment.js"),_moment2=_interopRequireDefault(_moment),_datePicker=require("./../../components/datePicker.js"),_datePicker2=_interopRequireDefault(_datePicker),_http=require("./../../http.js"),lectureForm=function(t){function e(){var t,i,n,o;_classCallCheck(this,e);for(var a=arguments.length,r=Array(a),u=0;u<a;u++)r[u]=arguments[u];return i=n=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(r))),n.$repeat={},n.$props={datePicker:{bindsetDate:"setDate","xmlns:v-bind":"","v-bind:data.sync":"form.starttime","v-bind:disabled.sync":"isEdit"}},n.$events={},n.components={datePicker:_datePicker2.default},n.data={form:{title:"",uid:wx.getStorageSync("rendaUid"),invitation_letter:"",enclosure:"",starttime:""},isScaleModal:!0,editorCtx:null,fileImg:"",value:"",formats:{},id:""},n.config={navigationBarTitleText:"空中宣讲会"},n.events={setDate:function(t){n.form.starttime=t}},n.computed={isEdit:function(){return this.form.status>=4}},n.methods={format:function(t){var e=t.target.dataset,i=e.name,n=e.value;i&&this.editorCtx.format(i,n)},onEditorReady:function(){var t=this;wx.createSelectorQuery().select("#editor").context(function(e){t.editorCtx=e.context}).exec()},viewJob:function(){(0,_util.wxNavigateTo)("/pages/my/jobManage?query=lecture")},insertImage:function(){var t=this;this.form.status>=4||wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){(0,_util.compressImg)(e.tempFilePaths[0]).then(function(e){t.getImg([e.url])})}})},onStatusChange:function(t){var e=t.detail;this.formats=e,this.$apply()},handleChange:function(t){this.value=t.dateString;var e=(0,_moment2.default)(t.dateString).valueOf()+"";this.form.starttime=e.substring(0,10),this.$apply()},uploadImg:function(){var t=this;wx.chooseMessageFile({count:1,success:function(e){var i=e.tempFiles[0];if("image"==i.type)t.form.type=2,(0,_util.compressImg)(i.path).then(function(e){t.upload([e.url])});else{if(console.log(i),i.name.indexOf("Ogg")>-1)return void(0,_util.wxToast)("请上传PM4格式的视频");wx.showLoading({title:"视频上传中"}),t.form.type=1,console.log(i.path),t.upload([i.path])}}})},onChange:function(t){var e=t.currentTarget.dataset.name;this.form[e]=t.detail.html,this.$apply()},changeInput:function(t){var e=t.currentTarget.dataset.name;this.form[e]=t.detail.value},submit:function(){this.form.title?this.form.link_man?this.form.link_tel?(0,_util.checkMobile)(this.form.link_tel)?this.form.invitation_letter?this.editLecture():(0,_util.wxToast)("请输入招聘简章"):(0,_util.wxToast)("请输入正确的联系人电话"):(0,_util.wxToast)("请输入联系人电话"):(0,_util.wxToast)("请输入联系人"):(0,_util.wxToast)("请输入宣讲会名称")},deleteLecture:function(){var t=this,e={uid:wx.getStorageSync("rendaUid"),id:this.form.id},i=3==this.form.status?"确定删除该职位吗":"确定删除该职位吗？删除之后你将不能查看该宣讲会下的回放";(0,_util.wxShowModal)("",i,"确定").then(function(i){t.delcture(e)}).catch(function(){console.log("取消")})},cancleSubmit:function(){var t=this,e={uid:wx.getStorageSync("rendaUid"),id:this.form.id};(0,_util.wxShowModal)("","确定取消申请吗","确定").then(function(i){t.cancleLecture(e)}).catch(function(){console.log("取消")})}},o=i,_possibleConstructorReturn(n,o)}return _inherits(e,t),_createClass(e,[{key:"onLoad",value:function(t){t.query&&(this.id=t.query,this.getDetail(this.id))}},{key:"getDetail",value:function(t){var e=this,i={uid:wx.getStorageSync("rendaUid"),id:t};(0,_http.$http)("/alecture/getAlectureInfo",i).then(function(t){e.form=t.data,e.value=_moment2.default.unix(t.data.starttime).format("YYYY-MM-DD HH:mm"),e.fileImg=t.data.enclosure,e.$apply(),wx.createSelectorQuery().select("#editor").context(function(t){e.editorCtx=t.context,e.editorCtx.setContents({html:e.form.invitation_letter||"请输入招聘简章",success:function(){console.log("insert html success")}})}).exec()})}},{key:"cancleLecture",value:function(t){(0,_http.$http)("/alecture/withdrawAlecture",t).then(function(t){t.data?((0,_util.wxToast)("操作成功"),wx.navigateBack({delta:1})):(0,_util.wxToast)("操作失败")})}},{key:"editLecture",value:function(){var t=this.id?"/alecture/editAlecture":"/alecture/createAlecture";this.form.uid=wx.getStorageSync("rendaUid"),(0,_http.$http)(t,this.form).then(function(t){t.data?((0,_util.wxToast)("保存成功"),wx.navigateBack({delta:1})):(0,_util.wxToast)("保存失败")})}},{key:"delcture",value:function(t){(0,_http.$http)("/alecture/deleteAlecture",t).then(function(t){t.data?((0,_util.wxToast)("删除成功"),wx.navigateBack({delta:1})):(0,_util.wxToast)("删除失败")})}},{key:"upload",value:function(t){var e=this;console.log(t),(0,_http.uploadFileVideo)(t).then(function(t){console.log(t),1==e.form.type&&wx.hideLoading(),e.fileImg=(0,_util.getImgUrl)(t.data.url),console.log(e.fileImg),console.log(e.form.type),e.form.enclosure=e.fileImg,e.$apply()})}},{key:"getImg",value:function(t){var e=this;(0,_http.uploadFile)(t).then(function(t){if(t.data&&t.data.url){var i=(0,_util.getImgUrl)(t.data.url);e.editorCtx.insertImage({src:i,success:function(){}}),e.$apply()}else(0,_util.wxToast)("图片获取失败")})}}]),e}(_wepy2.default.page);Page(require("./../../npm/wepy/lib/wepy.js").default.$createPage(lectureForm,"pages/lecture/lectureForm"));