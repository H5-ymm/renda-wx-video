"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),_wepy=require("./../../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_http=require("./../../http.js"),_util=require("./../../util.js"),_jobTemplate=require("./../../components/jobTemplate.js"),_jobTemplate2=_interopRequireDefault(_jobTemplate),viewJob=function(e){function t(){var e,o,n,i;_classCallCheck(this,t);for(var r=arguments.length,a=Array(r),u=0;u<r;u++)a[u]=arguments[u];return o=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),n.$repeat={},n.$props={jobTemplate:{"xmlns:v-bind":"","v-bind:form.sync":"form"}},n.$events={},n.components={jobTemplate:_jobTemplate2.default},n.data={form:{},id:"",room_num:"",apply:""},n.config={navigationBarTitleText:"发单详情"},n.methods={handleShelf:function(){var e=this,t={uid:this.form.uid,id:this.form.id,job_status:1==this.form.job_status?2:1},o=1==this.form.job_status?"下架":"上架";(0,_util.wxShowModal)("","确定"+o+"的申请单子").then(function(o){e.setReceiptShelf(t)}).catch(function(){console.log("取消")})},handleApply:function(){var e={uid:this.form.uid,job_id:this.id};this.setReceipt(e)},entryVideo:function(){var e=this,t={room_name:wx.getStorageSync("phone"),room_num:this.room_num};(0,_util.wxShowModal)("视频面试","请确认已与企业电话沟通时间，未沟通可能造成视频面试失败?").then(function(o){e.getuserSig(t)}).catch(function(){console.log("取消")})},handleDelete:function(){var e=this,t={uid:wx.getStorageSync("rendaUid"),id:this.form.id};(0,_util.wxShowModal)("","确定删除团队申请记录","确定").then(function(o){e.deleteReceiptShelf(t)}).catch(function(){console.log("取消")})},contactPhone:function(){wx.showActionSheet({itemList:["拨打021-51991869"],success:function(e){wx.makePhoneCall({phoneNumber:"021-51991869"})},fail:function(e){console.log(e.errMsg)}})}},i=o,_possibleConstructorReturn(n,i)}return _inherits(t,e),_createClass(t,[{key:"onLoad",value:function(e){this.id=e.query,e.room_num&&(this.room_num=e.room_num),e.apply&&(this.apply=e.apply),this.$apply(),this.getInvoiceDetail()}},{key:"getInvoiceDetail",value:function(){var e=this;(0,_http.$http)("/receipt/invoiceInfo",{id:this.id}).then(function(t){e.form=t.data,e.form.job_content=e.form.job_content.replace("/<br>/g",""),e.$apply()})}},{key:"setReceiptShelf",value:function(e){var t=this;(0,_http.$http)("/company/companyReceiptShelf",e).then(function(o){t.form.job_status=e.job_status,t.$apply(),(0,_util.wxToast)("操作成功")})}},{key:"deleteReceiptShelf",value:function(e){(0,_http.$http)("/company/delReceiptShelf",e).then(function(e){(0,_util.wxToast)("删除成功"),(0,_util.wxReLaunch)("/pages/companyView/checkReceipt")})}},{key:"getuserSig",value:function(e){var t=this;(0,_http.$http)("/Tencentcloud/createQuanjian",{name:e.room_name}).then(function(o){e.userSig=o.data,wx.setStorageSync("viewList",""),t.routerView(e)})}},{key:"routerView",value:function(e){console.log(e);var t="/pages/room/room?roomID="+e.room_num+"&userSig="+e.userSig+"&template=grid&debugMode=false&cloudenv=PRO&localVideo=true&localAudio=true&enableEarMonitor=false&enableAutoFocus=true&localMirror=auto&enableAgc=true&enableAns=true&encsmall=true&frontCamera=front&videoWidth=360&videoHeight=640&scene=rtc&userID="+e.room_name+"&minBitrate=600&maxBitrate=900";wx.navigateTo({url:t})}},{key:"setReceipt",value:function(e){(0,_http.$http)("/apply/add_apply",e).then(function(e){e.data?((0,_util.wxToast)("接单成功"),wx.setStorageSync("receiptType",0),(0,_util.wxNavigateTo)("/pages/teamView/orderManage/list?query=0")):(0,_util.wxToast)("接单失败")})}}]),t}(_wepy2.default.page);Page(require("./../../npm/wepy/lib/wepy.js").default.$createPage(viewJob,"pages/companyView/viewJob"));