"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),_wepy=require("./../../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_http=require("./../../http.js"),_noticeModal=require("./../../components/noticeModal.js"),_noticeModal2=_interopRequireDefault(_noticeModal),_tabBar=require("./../../components/tabBar.js"),_tabBar2=_interopRequireDefault(_tabBar),_search=require("./../../components/search.js"),_search2=_interopRequireDefault(_search),_companyResumeList=require("./../../components/companyResumeList.js"),_companyResumeList2=_interopRequireDefault(_companyResumeList),_viewNoticeModal=require("./../../components/viewNoticeModal.js"),_viewNoticeModal2=_interopRequireDefault(_viewNoticeModal),_moment=require("./../../npm/moment/moment.js"),_moment2=_interopRequireDefault(_moment),_util=require("./../../util.js"),noticeRecord=function(e){function t(){var e,i,a,r;_classCallCheck(this,t);for(var o=arguments.length,n=Array(o),s=0;s<o;s++)n[s]=arguments[s];return i=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n))),a.components={tabBar:_tabBar2.default,noticeModal:_noticeModal2.default,search:_search2.default,companyResumeList:_companyResumeList2.default,viewNoticeModal:_viewNoticeModal2.default},a.data={dateValue:"",startValue:"",list:[],params:{uid:"",time:"",jobId:""},isCheck:!1,receiptType:1,statusObj:{},job_id:"",timeInfo:{},id:"",check:!1,viewType:1,resume_id:"",room_num:"",time:""},a.computed={apiUrl:function(){return 1===this.receiptType?"/videointerview/videoInterviewNoticeRecord":"/videointerview/videoInterviewList"}},a.methods={bindDateChange:function(e){var t=e.detail.value;this.dateValue=e.detail.value,t=new Date(t).getTime()+"",t=t.substring(0,10),this.params.time=t,this.getCheckList()},selectResume:function(e,t,i,a){var r=this,o=[];if(i&&-1!=a){if(this.list[t].data[a].disabled=!i.disabled,-1===o.indexOf(i.id))o.push(i.id);else{this.list[t].data[a].disabled=!i.disabled;var n=o.findIndex(function(e){return e===i.id});o.splice(n,1)}o=Array.from(new Set(o))}else this.list[t].disabled=!e.disabled,i.interview_status||o.push(i.id),this.list[t].data.forEach(function(e){e.disabled=r.list[t].disabled});o.length==e.data.length?this.list[t].disabled=!0:this.list[t].disabled=!1,this.room_num=e.room_num,this.job_id=e.job_id,this.$apply()},videoView:function(){var e=this;if(!this.job_id)return(0,_util.wxToast)("请选择视频面试人员");var t={room_name:wx.getStorageSync("phone"),room_num:this.room_num};(0,_util.wxShowModal)("","确定视频面试吗?").then(function(i){e.getuserSig(t)}).catch(function(){console.log("取消")})}},r=i,_possibleConstructorReturn(a,r)}return _inherits(t,e),_createClass(t,[{key:"onLoad",value:function(e){this.params.jobId=e.jobId;var t=(new Date).getTime()+"";t=t.substr(0,10),this.params.time=t,this.receiptType=Number(wx.getStorageSync("receiptType")),this.$apply(),wx.setNavigationBarTitle({title:1==this.receiptType?"通知记录":"视频列表"})}},{key:"onShow",value:function(){this.params.uid=wx.getStorageSync("rendaUid")||this.$parent.globalData.uid,this.getCheckList()}},{key:"getuserSig",value:function(e){var t=this;(0,_http.$http)("/Tencentcloud/createQuanjian",{name:e.room_name}).then(function(i){e.userSig=i.data;var a={jobId:t.job_id,time:t.room_num};wx.setStorageSync("viewList",JSON.stringify(a)),t.routerView(e)})}},{key:"routerView",value:function(e){var t="/pages/room/room?roomID="+e.room_num+"&userSig="+e.userSig+"&template=grid&debugMode=false&cloudenv=PRO&localVideo=true&localAudio=true&enableEarMonitor=false&enableAutoFocus=true&localMirror=auto&enableAgc=true&enableAns=true&encsmall=true&frontCamera=front&videoWidth=360&videoHeight=640&scene=rtc&userID="+e.room_name+"&minBitrate=600&maxBitrate=900";(0,_util.wxNavigateTo)(t)}},{key:"getCheckList",value:function(){var e=this;(0,_http.$http)(this.apiUrl,this.params).then(function(t){var i=[];i=2==e.receiptType?e.checkAll(t.data.data,!1):t.data.data||[],e.list=(0,_util.getList)(i,"time"),e.$apply()})}},{key:"checkAll",value:function(e,t){return e.map(function(e){var i=e.data.filter(function(e,i){return e.interview_status||(e.disabled=t),e});return Object.assign(e,{data:i,disabled:!1})})}}]),t}(_wepy2.default.page);Page(require("./../../npm/wepy/lib/wepy.js").default.$createPage(noticeRecord,"pages/companyView/noticeRecord"));