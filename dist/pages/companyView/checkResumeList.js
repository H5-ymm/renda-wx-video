"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),_wepy=require("./../../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_http=require("./../../http.js"),_noticeModal=require("./../../components/noticeModal.js"),_noticeModal2=_interopRequireDefault(_noticeModal),_tabBar=require("./../../components/tabBar.js"),_tabBar2=_interopRequireDefault(_tabBar),_search=require("./../../components/search.js"),_search2=_interopRequireDefault(_search),_companyResumeList=require("./../../components/companyResumeList.js"),_companyResumeList2=_interopRequireDefault(_companyResumeList),_viewNoticeModal=require("./../../components/viewNoticeModal.js"),_viewNoticeModal2=_interopRequireDefault(_viewNoticeModal),_util=require("./../../util.js"),checkResumeList=function(e){function t(){var e,i,s,a;_classCallCheck(this,t);for(var n=arguments.length,o=Array(n),r=0;r<n;r++)o[r]=arguments[r];return i=s=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),s.$repeat={},s.$props={tabBar:{"xmlns:v-bind":"","v-bind:tabBarList.sync":"tabBarList","xmlns:wx":""},noticeModal:{"v-bind:isScaleModal.sync":"isNoticeModal","v-bind:height.sync":"modalHeight",bindsetAllTime:"setAllTime","v-bind:timeInfo.sync":"timeInfo","v-bind:title.sync":"title","v-bind:type.sync":"viewType"},search:{class:"search-box {{isSeachWidth?'weui-flex__item':''}}",bindsearchValue:"searchValue"},companyResumeList:{"v-bind:list.sync":"newList",bindhandleResumeVideo:"handleResumeVideo","v-bind:viewType.sync":"viewType","v-bind:receiptType.sync":"receiptType","v-bind:isBatch.sync":"isBatch","v-bind:isCheck.sync":"isCheck",bindviewDetail:"viewDetail",bindhandleResume:"handleResume",bindselectResume:"selectResume"},viewNoticeModal:{"v-bind:isScaleModal.sync":"isModal","v-bind:height.sync":"modalHeight","v-bind:timeInfo.sync":"timeInfo","v-bind:title.sync":"title"}},s.$events={},s.components={tabBar:_tabBar2.default,noticeModal:_noticeModal2.default,search:_search2.default,companyResumeList:_companyResumeList2.default,viewNoticeModal:_viewNoticeModal2.default},s.data={tabBarList:[],list:[],params:{uid:"",page:1,limit:500,status:"",type:1},count:0,isBatch:!1,isCheck:!1,activeIndex:0,isSeachWidth:!1,isModal:!0,modalHeight:920,title:"",receiptType:1,statusObj:{},job_id:"",timeInfo:{},id:"",check:!1,viewType:"1",isNoticeModal:!0,userSig:"",checkObj:{},isCheckAll:!1,resume_id:""},s.computed={newList:function(){return(0,_util.getList)(this.list,"addtime")},urlApi:function(){return 1===this.receiptType?"/company/auditResumeList":2===this.receiptType?"/company/entryRecommendResumeList":"/company/entryUserRecommendResumeList"},checkUrlAPI:function(){return 1===this.receiptType?"/company/auditResumeRecommend":2===this.receiptType?"/company/auditInterviewResumeRecommend":"/company/updateEntryUser"},timeUrlApi:function(){return 1===this.receiptType?"/company/editInterviewTime":"/company/editEntryTime"},overViewAndEntry:function(){return 1===this.receiptType?"/company/endInterview":"/company/endEntry"},isCheckBtn:function(){return 1===this.receiptType&&this.statusObj.invoice_status<2||2===this.receiptType&&this.statusObj.interview_status<5||3===this.receiptType&&this.statusObj.entry_status<2},isShowOverBtn:function(){return this.statusObj.view_time&&1==this.statusObj.interview_status&&this.check||this.statusObj.entry_time&&(1==this.statusObj.entry_status||this.statusObj.entry_status>2)&&this.check}},s.events={searchValue:function(e){s.params=Object.assign(s.params,{where:e}),s.getCheckList()},inputFocus:function(){s.isSeachWidth=!0,s.$apply()},switchTab:function(e){s.activeIndex=e,s.activeIndex?s.params.status=e-1:s.params.status="",s.getCheckList(),s.$apply()},handleResume:function(e){if(e.type=s.viewType,console.log(1==e.status&&"2判断"==s.viewType),1==e.status&&2==s.viewType)s.modalHeight=750,s.checkObj={status:e.status,id:e.id,type:e.type,uid:wx.getStorageSync("rendaUid")},s.id=e.id,s.resume_id=e.resume_id,s.isNoticeModal=!s.isNoticeModal,s.$apply();else{if(!s.statusObj.view_time&&3!=s.receiptType)return s.isNoticeModal=!s.isNoticeModal,void s.$apply();s.auditResumeRecommend(e)}},handleResumeVideo:function(e){var t={room_name:wx.getStorageSync("phone"),room_num:e.room_num},i={jobId:s.job_id,time:e.room_num};wx.setStorageSync("viewList",JSON.stringify(i));var a=1==s.viewType?"正常":"视频";(0,_util.wxShowModal)("","确定"+a+"面试吗?").then(function(e){s.getuserSig(t)}).catch(function(){console.log("取消")})},setAllTime:function(e){var t=Object.assign(e,{uid:s.params.uid,job_id:s.job_id});2!=s.viewType?s.setDate(t):(t.resume_list=s.resume_id,s.setVideoNotice(t))},selectResume:function(e){if(2==s.viewType&&e.id.length>8)return(0,_util.wxToast)("视频面试最多选择8个简历");e.id.length==s.newList.length&&(s.isCheck=!0,s.$apply()),e&&e.id.length&&(s.id=e.id.join(","),s.resume_id=e.resume_id.join(","))},viewDetail:function(e){var t="?resume_id="+e;wx.navigateTo({url:"/pages/companyView/checkResumeDetail"+t})}},s.methods={switchView:function(e){this.viewType=e,this.params.type=this.viewType,this.$apply(),this.getCheckList(),this.getTotal(this.tabBarList)},batchHandle:function(){if(2!=this.receiptType){if(1==this.viewType&&!this.statusObj.view_time&&3!=this.receiptType)return void(this.isNoticeModal=!this.isNoticeModal);this.isBatch=!0,this.list=this.checkAll(this.list,!1),this.$apply()}else(0,_util.wxNavigateTo)("/pages/companyView/noticeRecord?jobId="+this.job_id)},viewNotice:function(){2!=this.viewType||2==this.receiptType&&this.statusObj.is_video?this.viewTimeInfo():(0,_util.wxNavigateTo)("/pages/companyView/noticeRecord?jobId="+this.job_id)},selectResumeAll:function(e){this.isCheck=!e,this.list=this.checkAll(this.list,this.isCheck);var t=this.list.map(function(e){if(e.disabled)return e.id}),i=this.list.map(function(e){if(e.disabled)return e.resume_id});t.length&&(this.id=t.join(",")),i.length&&(this.resume_id=i.join(",")),this.$apply()},overView:function(){var e=this,t=1===this.receiptType?"面试":"入职";(0,_util.wxShowModal)("","确定提前结束"+t).then(function(t){e.overInterview()}).catch(function(){console.log("取消")})},setResumeStatus:function(e){if(!this.isCheck||!this.id)return(0,_util.wxToast)("请选择简历");var t={status:e,uid:wx.getStorageSync("rendaUid"),id:this.id,type:this.viewType};1==e&&2==this.viewType?(this.modalHeight=750,this.checkObj=t,this.isNoticeModal=!this.isNoticeModal,this.$apply()):this.auditResumeRecommend(t)},setNotice:function(){if(!this.isCheck||!this.resume_id)return(0,_util.wxToast)("请选择简历");this.modalHeight=750,this.isNoticeModal=!this.isNoticeModal,this.$apply()},viewEntry:function(){wx.setStorageSync("receiptType",3),(0,_util.wxNavigateTo)("/pages/companyView/resumeSiftings?query=3&jobId="+this.job_id)}},a=i,_possibleConstructorReturn(s,a)}return _inherits(t,e),_createClass(t,[{key:"onLoad",value:function(e){console.log(e),this.receiptType=Number(e.query)||Number(wx.getStorageSync("receiptType")),this.viewType=e.setTime||"1",console.log(this.viewType+"面试类型"),this.job_id=e.job_id,1===this.receiptType?(this.title="面试",this.params.job_id=e.job_id):(this.title="入职",this.params.jobId=e.job_id),this.$apply(),wx.setNavigationBarTitle({title:this.getTitle(this.receiptType)})}},{key:"onShow",value:function(){this.params.type=this.viewType,this.params.uid=wx.getStorageSync("rendaUid")||this.$parent.globalData.uid,this.statusObj=JSON.parse(wx.getStorageSync("statusObj")),this.tabBarList=this.getTabBarList(this.receiptType),this.getCheckList(),this.$apply()}},{key:"setDate",value:function(e){var t=this;(0,_http.$http)(this.timeUrlApi,e).then(function(e){e.data?(t.isNoticeModal=!0,t.$apply()):(0,_util.wxToast)("设置时间失败")})}},{key:"setVideoNotice",value:function(e){var t=this;(0,_http.$http)("/company/setVideoInterviewTime",e).then(function(i){i.data?t.auditResumeRecommend(t.checkObj,e):(0,_util.wxToast)("设置失败")})}},{key:"getuserSig",value:function(e){var t=this;(0,_http.$http)("/Tencentcloud/createQuanjian",{name:e.room_name}).then(function(i){e.userSig=i.data,t.routerView(e)})}},{key:"routerView",value:function(e){var t="/pages/room/room?roomID="+e.room_num+"&userSig="+e.userSig+"&template=grid&debugMode=false&cloudenv=PRO&localVideo=true&localAudio=true&enableEarMonitor=false&enableAutoFocus=true&localMirror=auto&enableAgc=true&enableAns=true&encsmall=true&frontCamera=front&videoWidth=360&videoHeight=640&scene=rtc&userID="+e.room_name+"&minBitrate=600&maxBitrate=900";wx.navigateTo({url:t})}},{key:"auditResumeRecommend",value:function(e,t){var i=this;e.type=this.viewType,console.log(e),(0,_http.$http)(this.checkUrlAPI,e).then(function(e){if(e.data){if(t)return void i.getuserSig(t);(i.isCheck||i.check)&&(1===i.receiptType&&(i.statusObj.invoice_status=4,i.isNoticeModal=!1,1==i.viewType?i.modalHeight=930:i.modalHeight=750),2===i.receiptType&&(i.statusObj.interview_status=4),i.isBatch=!1,i.$apply()),i.getTotal(i.tabBarList),i.getCheckList()}else(0,_util.wxToast)("操作失败")})}},{key:"overInterview",value:function(){var e=this,t={jobId:this.job_id,uid:this.params.uid};(0,_http.$http)(this.overViewAndEntry,t).then(function(t){t.data?(1===e.receiptType&&(e.statusObj.invoice_status=2),2===e.receiptType&&(e.statusObj.interview_status=2),e.$apply(),wx.setStorageSync("receiptType",e.receiptType),wx.setStorageSync("statusObj",JSON.stringify(e.statusObj)),(0,_util.wxNavigateTo)("/pages/companyView/resumeSiftings?query="+e.receiptType)):(0,_util.wxToast)("操作失败")})}},{key:"checkAll",value:function(e,t){var i=this;return e.filter(function(e){if(!e.status||!e.is_time&&2==i.viewType)return e.disabled=t,e})}},{key:"getTabBarList",value:function(e){var t=[],i=[{name:"全部简历",num:0},{name:"待审核",num:0}];t=1===e?[{name:"已同意",num:0},{name:"已拒绝",num:0}]:2===e?[{name:"已通过",num:0},{name:"未通过",num:0}]:[{name:"已入职",num:0},{name:"未入职",num:0}];var s=i.concat(t);return this.getTotal(s),s}},{key:"getTotal",value:function(e){var t=this,i={uid:this.params.uid,job_id:this.job_id,type:this.receiptType};3!=this.receiptType&&(i.view_type=this.viewType),(0,_http.$http)("/company/getAuditResumeNum",i).then(function(i){i.data&&(e[0].num=i.data.allNum,e[1].num=i.data.auditedNum,e[2].num=i.data.adoptNum,e[3].num=i.data.referNum,t.$apply())})}},{key:"viewTimeInfo",value:function(){var e=this;(0,_http.$http)("/company/selectInterviewEntryInfo",{id:this.job_id}).then(function(t){var i={};e.viewType="1",i=1===e.receiptType?{time:t.data.view_time,content:t.data.content,provinceid:t.data.interview_provinceid,cityid:t.data.interview_cityid,three_cityid:t.data.interview_three_cityid}:{time:t.data.entry_time,content:t.data.entry_comtent,provinceid:t.data.entry_provinceid,cityid:t.data.entry_cityid,three_cityid:t.data.entry_three_cityid},e.modalHeight=930,e.timeInfo=i,e.isNoticeModal=!e.isNoticeModal,e.$apply()})}},{key:"getCheckList",value:function(){var e=this;(0,_http.$http)(this.urlApi,this.params).then(function(t){e.list=t.data.data||[];e.list.some(function(e){if(!e.is_time)return!1});e.receiptType&&(e.check=e.checkStatus(e.list,e.receiptType)),e.count=t.data.count,e.$apply()})}},{key:"checkStatus",value:function(e,t){var i="";return i=1===t?"status":2==t?"interview_status":"entry_status",e.every(function(e){return e[i]})}},{key:"getTitle",value:function(e){return 1===e?"简历列表":2===e?"面试审核":"入职审核"}}]),t}(_wepy2.default.page);Page(require("./../../npm/wepy/lib/wepy.js").default.$createPage(checkResumeList,"pages/companyView/checkResumeList"));