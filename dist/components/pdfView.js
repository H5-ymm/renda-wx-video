"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_http=require("./../http.js"),_moment=require("./../npm/moment/moment.js"),_moment2=_interopRequireDefault(_moment),_util=require("./../util.js"),_jobList=require("./jobList.js"),_jobList2=_interopRequireDefault(_jobList),_tabBar=require("./tabBar.js"),_tabBar2=_interopRequireDefault(_tabBar),pdfView=function(t){function e(){var t,i,n,a;_classCallCheck(this,e);for(var o=arguments.length,s=Array(o),r=0;r<o;r++)s[r]=arguments[r];return i=n=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(s))),n.$repeat={},n.$props={jobLectureList:{"v-bind:list.sync":"list",class:"scroll-view",jobType:"2","xmlns:v-on":"","xmlns:wx":""},tabBar:{"xmlns:v-bind":"","v-bind:tabBarList.sync":"tabBarList",bindswitchTab:"switchTab",class:"header-tab"}},n.$events={jobLectureList:{"v-on:deliverResume":"applyResume"}},n.components={jobLectureList:_jobList2.default,tabBar:_tabBar2.default},n.props={lectureInfo:Object,overBtnShow:Boolean},n.data={params:{page:1,limit:10},rendaUserType:0,list:[],pdfName:"",id:"",uid:"",com_id:"",page:0,tabBarList:[{name:"ppt展示"},{name:"公司简介"},{name:"招聘职位"}],activeIndex:0,pdfList:[],total:0,enclosure:"",flag:!0},n.events={switchTab:function(t){n.activeIndex=t,n.$apply(),0==n.activeIndex&&n.enclosure&&n.getPdftopng(n.page),2==n.activeIndex&&n.getCompanyJobList(n.com_id)},applyResumeOk:function(){n.getCompanyJobList(n.com_id)},searchScrollLower:function(){this.count>this.list.length&&this.count>this.params.limit&&(this.params.limit=this.params.limit+10,this.endAlectureList())}},n.methods={applyResume:function(t){this.$emit("applyResume",t)},uploadFile:function(){this.uid==this.lectureInfo.com_uid&&this.uploadPdf()},viewPdf:function(){2==this.rendaUserType?(console.log(this.enclosure),wx.showLoading(),wx.downloadFile({url:this.enclosure,success:function(t){var e=t.tempFilePath;wx.openDocument({filePath:e,success:function(t){wx.hideLoading(),console.log("打开文档成功")}})}})):this.uploadPdf()},viewImg:function(t){wx.previewImage({current:t,urls:this.pdfList})},deleteFile:function(){var t=this;(0,_util.wxShowModal)("","确定删除附件吗?","确定").then(function(e){var i={id:t.id,dir:t.enclosure};(0,_http.$http)("/alecture/delFile",i).then(function(e){e.data?(t.pdfName="",t.enclosure="",t.pdfList=[],t.page=0,t.$apply(),(0,_util.wxToast)("删除成功")):(0,_util.wxToast)("删除失败")})}).catch(function(){console.log("取消")})},viewInfo:function(t){(0,_util.wxNavigateTo)(t.url)},viewDetail:function(t){(0,_util.wxNavigateTo)("/pages/companyView/viewJob?query="+t.id+"&apply=1")},bindchange:function(t){this.page<this.total-1&&this.addBtn?(this.page=this.page+1,this.$apply(),this.getPdftopng(this.page)):this.page=t.detail.current},changeFinish:function(){this.addBtn=!1,this.flag=!0},preImg:function(){if(this.flag){if(0==this.page)return(0,_util.wxToast)("这是第一张了");this.page=this.page-1,this.addBtn=!1,this.$apply()}},nextImg:function(){if(this.flag){if(this.addBtn=!0,this.page=Number(this.page)+1,this.page>this.total-1)return this.page=this.page-1,(0,_util.wxToast)("最后一张了");this.getPdftopng(this.page)}}},n.watch={lectureInfo:function(t){t&&(console.log(t),this.pdfName=t.file_name||"",this.enclosure=t.file,console.log(t.file),this.com_id=t.com_id,this.id=t.id,this.$apply(),this.enclosure&&this.getPdftopng(this.page))}},a=i,_possibleConstructorReturn(n,a)}return _inherits(e,t),_createClass(e,[{key:"getCompanyJobList",value:function(t){var e=this,i={com_id:t,uid:this.uid};(0,_http.$http)("/alecture/getCompanyJobList",i).then(function(t){e.list=t.data,e.$apply()})}},{key:"upload",value:function(t){var e=this;(0,_http.uploadFileVideo)(t).then(function(t){e.enclosure=(0,_util.getImgUrl)(t.data.url),e.$apply(),e.getPdftopng(e.page),e.addFile(e.enclosure)})}},{key:"addFile",value:function(t){var e={id:this.id,file:t,file_name:this.pdfName};(0,_http.$http)("/alecture/addAttachment",e).then(function(t){t.data?(0,_util.wxToast)("上传成功"):(0,_util.wxToast)("上传失败")})}},{key:"uploadPdf",value:function(){var t=this;wx.chooseMessageFile({count:1,type:"file",success:function(e){var i=e.tempFiles[0];-1==i.name.indexOf("pdf")?(0,_util.wxToast)("请上传pdf文件"):(t.pdfName=i.name,t.upload([i.path]))}})}},{key:"getPdftopng",value:function(t){var e=this;wx.showLoading({title:"pdf加载中"}),(0,_http.$http)("/homepresentation/getPdfToPng",{pdf:this.enclosure,page:t,preach_id:this.id}).then(function(t){var i=t.data.data;i.image=(0,_util.getImgUrl)(i.image),e.pdfList.push(i),e.total=t.data.countNum,e.$apply(),wx.hideLoading()})}},{key:"onLoad",value:function(){this.id=wx.getStorageSync("lectureId"),this.uid=wx.getStorageSync("rendaUid"),this.rendaUserType=wx.getStorageSync("rendaUserType"),this.enclosure=this.lectureInfo.file,console.log(this.lectureInfo.file),this.$apply()}}]),e}(_wepy2.default.component);exports.default=pdfView;